export const metadata = {
  title: "Constructors • Stylus by Example",
  description:
    "How to define, deploy, and verify constructors in Rust Stylus contracts.",
};

# **Stylus Constructors**

Starting in **SDK 0.9.0** Stylus supports **constructors**—an atomic way to _deploy → activate → initialize_ a contract in a **single transaction**.  Without a constructor the contract’s storage might be touched before your init logic runs, which can lead to subtle bugs. This page explains:

- How to declare a constructor in Rust Stylus.  
- How `cargo stylus` packages constructor arguments and calls the on-chain **StylusDeployer**.  
- A full, runnable example you can clone today.

## **1.  Declaring a Constructor**

A constructor is just a normal external function annotated with `#[constructor]`. Constructor can be defined as below similar to Solidity:

```rust
    #[constructor]
    pub fn constructor(&mut self, count: U256) {
        self.number.set(count);
    }
```

### **Rules & guarantees**

<style jsx>{`
  .rules-table {
    width: 100%;
    border-collapse: collapse;
    font-family: inherit;
  }

  .rules-table th,
  .rules-table td {
    border: 1px solid #d0d7de;
    padding: 0.6rem 0.75rem;
  }

  .rules-table th {
    background:rgb(82, 93, 104);
    font-weight: 600;
    text-align: left;
  }

  /* make top grid line single-width */
  .rules-table thead tr:first-child th {
    border-top: 0;
  }
`}</style>

<table className="rules-table">
  <thead>
    <tr>
      <th>Rule</th>
      <th>Why it exists</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Exactly 0 or 1 constructor</strong> per contract</td>
      <td>Mimics Solidity and avoids ambiguity</td>
    </tr>

    <tr>
      <td>
        Function <strong>must be annotated with <code>#[constructor]</code></strong><br />
        (name can be anything&ensp;→&ensp;external signature is always
        <code>constructor()</code>)
      </td>
      <td>
        Guarantees the deployer calls the correct init method; the SDK throws an
        error if a function named&nbsp;<code>constructor</code> lacks the macro
      </td>
    </tr>

    <tr>
      <td>Function <strong>must take <code>&amp;mut self</code></strong></td>
      <td>Writes to storage during deployment</td>
    </tr>

    <tr>
      <td>Returns <code>()</code> or <code>Result&lt;(), Vec&lt;u8&gt;&gt;</code></td>
      <td>Reverting aborts deployment</td>
    </tr>

    <tr>
      <td>SDK writes sentinel at <code>keccak256("stylus_constructor")</code></td>
      <td>Guarantees the constructor can never run twice</td>
    </tr>
  </tbody>
</table>


If your contract **inherits** another contract that defines a constructor you **must** call the parent’s constructor manually—Stylus will not inject it for you.


## **2.   Deploying with `cargo stylus`**

Stylus constructors are deployed through the on-chain **StylusDeployer** contract. `cargo stylus deploy` hides the details:

```bash
# dev-node ---------------------------------------------------
git clone https://github.com/OffchainLabs/nitro-devnode.git
cd nitro-devnode && ./run-dev-node.sh

# example repo ----------------------------------------------
git clone -b gligneul/constructors \
  https://github.com/OffchainLabs/stylus-hello-world.git
cd stylus-hello-world

export RPC=http://localhost:8547
export KEY_PATH=$HOME/.key.devnode.txt   # contains the dev-node private key

cargo stylus check -e $RPC               # optional static checks
cargo stylus deploy \
  --no-verify \
  -e $RPC \
  --private-key-path $KEY_PATH \
  --experimental-constructor-args 0xdeadbeef
```

`cargo stylus`:

- Uploads the Wasm byte-code with **CREATE2** (salt = hash of the code).  
- Sends enough ETH to activate the contract.  
- Encodes your constructor args (`0xdeadbeef` above) and calls the constructor.  
- Emits the deployed address.

### Verifying the result

```bash
cast call -r $RPC <DEPLOYED_ADDRESS> 'number()'
# 0x…deadbeef ✅
```

---

## **3.  Full Example**

**`src/lib.rs`**

```rust
#![cfg_attr(not(feature = "export-abi"), no_main)]
extern crate alloc;

use stylus_sdk::{alloy_primitives::U256, prelude::*};

sol_storage! {
    #[entrypoint]
    pub struct Counter {
        uint256 number;
    }
}

#[public]
impl Counter {
    #[constructor]
    pub fn constructor(&mut self, new_number: U256) {
        self.number.set(new_number);
    }

    pub fn number(&self) -> U256 {
        self.number.get()
    }

    pub fn set_number(&mut self, new_number: U256) {
        self.number.set(new_number);
    }
}
```

**`Cargo.toml`**

```toml
[package]
name = "stylus-constructor-example"
version = "0.1.0"
edition = "2021"

[dependencies]
stylus-sdk = { version = "0.9.0", features = ["export-abi"] }
alloy-primitives = "0.7.6"
```

